5장 구부러지거나 부러지거나

A. 결합도 줄이기와 디미터 법칙
 - ‘부끄럼타는 코드’란, 자신을 남에게 속속들이 드러내지 않고, 너무 많은 사람과 상호작용하지 말라는 두 가지 의미를 모두 내포한다.
 - 코드를 모듈로 구성하고, 이들 간의 상호작용을 제한하라. 한 모듈이 변경되거나 교체된다 하더라도 다른 모듈들은 변경 없이 수행될 수 있을 것이다.
 - 모듈간의 결합도를 최소화하라.

 A-1. 결합도 줄이기
  - 불필요한 의존이 많은 시스템은 유지보수하기 어렵고, 이로 인해 비용이 많이 들며 시스템 자체가 매우 불안정한 경향이 있다.

 A-2. 디미터 함수 법칙
  - 디미터 함수 법칙은 프로그램에서 모듈 간 결합도를 최소한하려 시도한다.
  - 이 법칙은 한 객체가 제공하는 메서드에 접근하기 위해 또 다른 객체들을 통하는 것을 허용하지 않는다.

 A-3. 확실히 차이를 낳는가?
  A-3-1. 디미터 법칙에서는 객체의 모든 메소드는 다음에 해당하는 메소드만 호출해야 한다.
   - 자신
   - 메소드로 넘어온 인자
   - 자신이 생성한 객체
   - 직접 포함하고 있는 객체

 - 디미터 법칙을 따르면 함수를 호출하는 클래스의 응답집합(response set) 크기를 줄일 수 있기 때문에 좀 더 에러가 적은 클래스를 만들 수 있다.
 - 디미터 법칙은 코드를 더 적응성있고, 강하게 만들어 주지만 ‘주계약자’로서 대가를 치러야 한다.
 - 주계약자는 모든 하부 계약자를 직접 관리하고, 이들에게 일을 위임해주어야 한다.

B. 메타 프로그래밍
 - 세부사항을 코드에서 몰아내라. 이렇게 함으로써 우리의 코드는 매우 설정 가능하게 되고, ‘소프트’해진다. 즉, 변화에 쉽게 적응할 수 있다.

 B-1. 동적 설정
  - 시스템을 되도록 설정가능하게 만들어라.
  - background, text, algorithm, DB 등 모든 것을 통합하거나 엔지니어링하지 말고 설정 옵션으로 구현하라.
  - 통합하지 말고 설정하라.

 B-2. 메타데이터 주도 애플리케이션
  - 메타데이터를 이용하여 반환 매개 변수, 사용자 선호사항, 설치 디렉터리와 같은 애플리케이션 설정 옵션을 기술하라.
  - 코드 : 추상화, 메타데이터 : 세부내용
 
  B-2-1. 위와 같이 접근한다면 생기는 이점
   - 설계의 결합도를 줄여 좀 더 유연하고 적응한 프로그램을 만들 수 있다.
   - 세부사항을 코드 밖으로 몰아냄으로서 보다 강하고 추상적인 디자인을 만들 수 있다.
   - 애플리케이션을 커스터마이징하기 위해 다시 컴파일할 필요가 없으며, 이런 방식의 커스터마이징을 통해 실제 제적 공정 시스템에서 일어날 수 있는 치명적인 버그에서 벗어나는 우회로를 쉽게 만들 수 있다.
   - 메타데이터는 범용 프로그래밍 언어보다 문제 도메인에 가까운 방식으로 표현될 수 있다.
   - 동일한 애플리케이션 엔진과 상이한 메타데이터를 이용해 여러 다른 프로젝트를 진행할 수 있게 된다.

C. 시간적 결합
 - 동시성을 허용할 필요가 있고 시간이나 순서에 따른 의존성의 결합을 끊는 방법을 생각할 필요가 있다.

 C-1. 작업 흐름
  - 동시에 일어나도 되는 것은 어떤 것이고, 엄격한 순서에 따라 일어나야 하는 것은 어떤 것인지 나타낼 수 있어야 한다.
  - UML 활동 다이어그램 같은 표기법을 사용해서 사용자들이 기술해 준 작업흐름을 기록하는 것이 하나의 방법이다.
  - 활동 다이어 램을 사용하면 동시에 수행될 수 있지만, 아직 그렇지 않은 활동들을 찾아내서 병렬성을 극대화할 수 있다.
  - 작업흐름 분석을 통해 동시성을 개선하라.

 C-2. 아키텍쳐
  C-2-1. 배고픈 소비자 모델 ( threadPool과 유사해 보임 )
   - 중앙 일정 관리자 대신 여러 개의 독립적인 소비자 작업들과 중앙집중식 잡업 큐를 사용한다.
   - 각 소비자 작업은 큐에서 하나씩 가져가서 그것을 처리하기 시작한다
   - 각 작업은 자기 일을 다 마치고 나면 다른 것을 더 가져오기 위해 큐로 간다.
   - 서비스를 사용해서 설계하라.

 C-3. 동시성을 고려한 설계
  - 동시성을 염두에 둔다면 여러 가지 일들을 더 주의 깊게 생각하게 될 수 밖에 없다.
  - 전역 변수나 정적 변수들을 동시 접근으로부터 보호해야 한다.
  - 호출 순서와 관계없이 일관성 있는 상태 정보를 보일 수 있는지도 확인해봐야 한다.

 C-4. 더 깔끔한 인터페이스
  - 동시성과 시간 순서에 따른 의존성을 고려하는 것은 더 깔끔한 인터페이스 설계를 이끈다.
  - 언제나 동시성을 고려해 설계하라.

D. 단지 뷰일 뿐이야
 D-1. 출판 / 구독
  - 모든 이벤트를 하나의 루틴에 몰아넣는 것은 객체 캡슐화에 위배된다.
  - 객체가 자기가 필요한 이벤트만 구독해서 받아보고 필요하지 않은 이벤트는 받지 않도록 해야 한다.
  - 시퀀스 다이어그램을 사용하라.
  - ‘출판자’가 보낸 이벤트들 가운데 흥미로운 것이 있다면 ‘출판자’에게 등록하면 된다.
  - ‘출판자’는 자기에게 흥미를 보인 ‘구독자’들의 목록을 유지한다.
  - ‘출판자’가 흥미로운 이벤트를 발생시키면, 출판자는 차례대로 ‘구독자’를 호출해서 이벤트가 발생했다고 알려준다.

 D-2. MVC ( model-view-controller )
  - model : 대상 객체를 나타내는 추상 데이터 모델, 모델은 어떤 뷰나 컨트롤러에 대해서도 직접적인 지식을 지니지 않는다.
  - view : 모델을 해석하는 방법, 뷰는 모델의 변화 그리고 컨트롤러가 보내는 논리적 사건을 구독한다.
  - controller : 뷰를 제어하고 모델에 새로운 데이터를 제공하는 방법, 모델과 뷰 둘 모두에게 이벤트를 보낸다.
  - 모델에서 뷰를 분리하라.

E. 칠판
 - 칠판 시스템을 이용하면, 지식의 소비자와 생산자들이 익명으로 그리고 비동기적으로 데이터를 주고받는 공간이 생긴다.

 E-1. 칠판 구현
  - 객체의 데이터뿐 아니라 자바 객체 전체를 칠판에 저장한 후, 필드의 부분일치 또는 유형별 검색을 통해 다시 가져올 수 있다.
  - JavaSpaces의 중심 기능
  - 칠판에 대한 일관성 있는 인터페이스 하나만 있으면 된다는 점이 이 시스템의 큰 장점이다.
  - 칠판을 이용하는 방식의 프로그래밍을 하면, 이렇게 많은 인터페이스가 필요 없어지기 때문에 더 우아하고 일관성 있는 시스템을 만들 수 있다.
  - 칠판을 사용해 작업흐름을 조율하라.

----------------------------------------------------------------

결합도 줄이기 : 직교성이 높은 프로그램을 작성해야 하는 것. 하나의 모듈에서 하나의 목적에 대한 동작만 할 수 있도록 구현해야 하는 것.

메타데이터 : 데이터에 대한 데이터, 즉 데이터를 사용하기 위해 커스터마이징한 데이터.

이를 이용하여 결합도를 줄일 수 있으며, 더 좋은 프로그램을 작성할 수 있음

 

메타데이터를 잘 활용하여 효율적으로 데이터를 관리해야 할 뿐 아니라, 시스템의 작업흐름, 동시성 등을 모두 고려하여 구현해야 한다.

----------------------------------------------------